{% extends "base.html" %}
{% block title %}Live Access Logs Â· CRL/OCSP{% endblock %}

{% block content %}
<div class="d-flex justify-content-between align-items-center mb-3 page-header">
  <h2>Live Access Logs</h2>
</div>

<div class="card shadow-sm mb-2">
  <div class="card-body d-flex gap-2 align-items-center">
    <div>File: <code>{{ path }}</code></div>
    <div class="ms-auto">
      <label class="form-label me-2">Lines</label>
      <input id="limit" type="number" min="50" max="1000" step="50" value="200" class="form-control d-inline-block" style="width:120px">
      <button id="btn-refresh" class="btn btn-outline-primary ms-2"><i class="bi bi-arrow-repeat"></i></button>
    </div>
  </div>
</div>

<div class="card shadow-sm">
  <div class="card-body logbox small" id="logbox" style="height: 60vh; overflow: auto;"></div>
</div>
{% endblock %}

{% block extra_js %}
<script>
  const logbox = document.getElementById('logbox');
  const limitInput = document.getElementById('limit');
  const btn = document.getElementById('btn-refresh');

  async function fetchLogs() {
    const limit = parseInt(limitInput.value || '200', 10);
    const resp = await fetch("{% url 'logs_access_live_poll' %}?limit=" + limit, {cache:"no-store"});
    const txt = await resp.text();
    logbox.textContent = txt;
    logbox.scrollTop = logbox.scrollHeight;
  }

  btn.addEventListener('click', (e) => { e.preventDefault(); fetchLogs(); });
  fetchLogs();                       // initial
  setInterval(fetchLogs, 2000);      // poll every 2s
</script>
{% endblock %}
